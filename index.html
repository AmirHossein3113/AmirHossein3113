<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø«Ø¨Øª Ù†Ø§Ù… Ø¯Ø± BLACK_STAR</title>
  <style>
    body {
      font-family: 'Vazir',  Lucida Calligraphy;
      margin: 0; padding: 0;
      background: #ffffff;
      direction: rtl;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .container {
      max-width: 400px;
      margin: 100px auto;
      background: rgb(78, 78, 78);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgb(104, 104, 104);
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    h2 {
      text-align: center;
      color: #ffffff;
      transition: color 0.3s ease;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    label {
      font-weight: bold;
      margin-bottom: 5px;
      transition: color 0.3s ease;
    }
    input {
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ffffff;
      font-size: 1rem;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    button {
      background-color: #929292;
      color: rgb(255, 255, 255);
      border: none;
      padding: 12px;
      font-size: 1.1rem;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #b8b8b8;
    }
    /* Ø­Ø§Ù„Øª Ø´Ø¨ */
    body.dark {
      background: #363636;
      color: #ffffff;
    }
    .container.dark {
      background: #353535;
      box-shadow: 0 2px 10px #ffffff;
    }
    h2.dark {
      color: #ffffff;
    }
    label.dark {
      color: #ffffff;
    }
    input.dark {
      background: #fcfcfc;
      color: #444444;
      border: 1px solid #565656;
    }
    #codeContainer {
      margin-top: 10px;
      padding: 10px;
      background: #5e5e5e;
      border-radius: 5px;
      display: none;
    }
    #verificationResult {
      margin-top: 5px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Registration</h2>
    <form id="registerForm">
      <label for="username">Username :</label>
      <input type="text" id="username" required placeholder="Enter your username" />

      <label for="contact">Phone number/email :</label>
      <input type="text" id="contact" required placeholder="Enter your mobaile number or email" />

      <label for="password">password :</label>
      <input type="password" id="password" required placeholder="Enter your password" maxlength="8" />

      <button id="sendCodeBtn" type="button">Receive verification code</button>

      <div id="codeContainer">
        <p>Your verification code<span id="generatedCode" style="font-weight:bold; font-size: 1.2em;"></span></p>
        <label for="inputCode">Enter the veritication code</label> :</label>
        <input type="text" id="inputCode" maxlength="8" />
        <button id="verifyCodeBtn" type="button">Confirm code</button>
        <p id="verificationResult"></p>
      </div>

      <button type="submit" id="submitBtn" disabled>Registration</button>
    </form>
  </div>

  <nav style="text-align: center; margin-top: 20px;">
    <button id="themeToggle">ğŸŒ—</button>
  </nav>

  <script>
    const registerForm = document.getElementById('registerForm');
    const usernameInput = document.getElementById('username');
    const contactInput = document.getElementById('contact');
    const passwordInput = document.getElementById('password');
    const sendCodeBtn = document.getElementById('sendCodeBtn');
    const codeContainer = document.getElementById('codeContainer');
    const generatedCodeSpan = document.getElementById('generatedCode');
    const inputCode = document.getElementById('inputCode');
    const verifyCodeBtn = document.getElementById('verifyCodeBtn');
    const verificationResult = document.getElementById('verificationResult');
    const submitBtn = document.getElementById('submitBtn');

    const themeToggle = document.getElementById('themeToggle');
    const container = document.querySelector('.container');
    const heading = document.querySelector('h2');
    const labels = document.querySelectorAll('label');
    const inputs = document.querySelectorAll('input');

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ… Ø§Ø² localStorage
    function loadTheme() {
      const theme = localStorage.getItem('theme');
      if (theme === 'dark') {
        document.body.classList.add('dark');
        container.classList.add('dark');
        heading.classList.add('dark');
        labels.forEach(l => l.classList.add('dark'));
        inputs.forEach(i => i.classList.add('dark'));
      }
    }

    // ØªØºÛŒÛŒØ± ØªÙ… Ø¨Ø§ Ø¯Ú©Ù…Ù‡
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark');
      container.classList.toggle('dark');
      heading.classList.toggle('dark');
      labels.forEach(l => l.classList.toggle('dark'));
      inputs.forEach(i => i.classList.toggle('dark'));

      // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
      if (document.body.classList.contains('dark')) {
        localStorage.setItem('theme', 'dark');
      } else {
        localStorage.setItem('theme', 'light');
      }
    });

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    loadTheme();

    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ (ÙÙ‚Ø· Ø­Ø±ÙˆÙ ÙØ§Ø±Ø³ÛŒ ÛŒØ§ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒØŒ Ø­Ø¯Ø§Ú©Ø«Ø± 40 Ú©Ø§Ø±Ø§Ú©ØªØ±)
    function validateUsername(name) {
      const regex = /^[\u0600-\u06FFa-zA-Z\s]{1,40}$/;
      return regex.test(name);
    }

    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ (11 Ø±Ù‚Ù… Ø¹Ø¯Ø¯ÛŒ) ÛŒØ§ Ø§ÛŒÙ…ÛŒÙ„ Ø³Ø§Ø¯Ù‡
    function validateContact(contact) {
      const phoneRegex = /^[0-9]{11}$/;
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return phoneRegex.test(contact) || emailRegex.test(contact);
    }

    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± (8 Ø±Ù‚Ù… Ø¹Ø¯Ø¯ÛŒ ÙØ§Ø±Ø³ÛŒ ÛŒØ§ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ)
    function validatePassword(pass) {
      const passRegex = /^[0-9\u06F0-\u06F9]{8}$/;
      return passRegex.test(pass);
    }

    // ØªÙˆÙ„ÛŒØ¯ Ú©Ø¯ ØªØµØ§Ø¯ÙÛŒ 8 Ø±Ù‚Ù…ÛŒ
    function generateRandomCode(length = 8) {
      const chars = '0123456789abcdefghijklmnopABCDEFIJKLMNOP';
      let code = '';
      for(let i=0; i<length; i++) {
        code += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return code;
    }

    let generatedCode = '';
    let codeVerified = false;

    sendCodeBtn.addEventListener('click', () => {
      // Ø§Ø¨ØªØ¯Ø§ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§
      const username = usernameInput.value.trim();
      const contact = contactInput.value.trim();
      const password = passwordInput.value.trim();

      if (!validateUsername(username)) {
        alert('Username is not allowed');
        return;
      }
      if (!validateContact(contact)) {
        alert('Enter a valid mobail number or email');
        return;
      }
      if (!validatePassword(password)) {
        alert('Password musr be 8 digits');
        return;
      }

      generatedCode = generateRandomCode(8);
      generatedCodeSpan.textContent = generatedCode;
      codeContainer.style.display = 'block';
      verificationResult.textContent = '';
      inputCode.value = '';
      codeVerified = false;
      submitBtn.disabled = true;
    });

    verifyCodeBtn.addEventListener('click', () => {
      if(inputCode.value.trim() === generatedCode) {
        verificationResult.style.color = 'green';
        verificationResult.textContent = 'The verification code is correctâœ…';
        codeVerified = true;
        submitBtn.disabled = false;
      } else {
        verificationResult.style.color = 'red';
        verificationResult.textContent = 'The verification code is incorrectâŒ';
        codeVerified = false;
        submitBtn.disabled = true;
      }
    });

    registerForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if(!codeVerified) {
        alert('Please enter and confirm the verification code firstâ—');
        return;
      }
      alert(`Registeration successfully completed WelcomeğŸ‰${usernameInput.value.trim()}!`);
      window.location.href = 'home.html';
    });
  </script>
</body>
</html>
